div#commit-message-display pre,
.message pre {
	background-color: transparent; /* Changed to transparent background */
	padding: 12px 16px; /* Increased padding for better visual appeal */
	border-radius: 6px; /* Slightly more rounded corners */
	margin-top: var(--code-margin-top, 0.8em);
	margin-bottom: var(--code-margin-bottom, 0.8em);
	border: 1px solid var(--vscode-editorWidget-border, var(--border-color)); /* Subtle border */
	white-space: pre-wrap; /* Preserve whitespace and allow wrapping */
	overflow-wrap: break-word; /* Ensure long lines and words wrap correctly within the code block, preventing horizontal scrolling. */
	overflow-x: auto; /* Enable horizontal scrolling for very long lines */
	font-family: var(
		--vscode-editor-font-family,
		"SF Mono",
		"Cascadia Code",
		"Fira Code",
		monospace
	); /* Use VSCode editor font family */
	font-size: 0.95em; /* Slightly smaller font for code blocks */
	position: relative; /* For potential pseudo-elements */
}

/* Ensure compact margins in terminal logs */
.message.context-agent-log pre {
	--code-margin-top: 4px;
	--code-margin-bottom: 4px;
	--code-consecutive-margin-top: 4px;
}

.code-file-stream-container {
	border: 1px solid var(--vscode-editorGroup-border);
	padding: 0; /* Remove padding here, will be handled by pre/footer */
	border-radius: 4px;
	background-color: var(--vscode-editor-background);
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
}
.code-file-stream-container pre {
	background-color: transparent; /* Changed to transparent background */
	padding: 12px 16px; /* Increased padding for better visual appeal */
	border-radius: 6px 6px 0 0; /* Rounded top corners, flat bottom */
	margin-top: 0; /* Remove top margin as container handles it */
	margin-bottom: 0; /* Remove bottom margin as footer is separate */
	border: none; /* No border for the pre itself, container has it */
	box-shadow: none; /* No shadow for the pre itself, container has it */
	white-space: pre-wrap; /* Preserve whitespace and allow wrapping */
	overflow-wrap: break-word; /* Ensure long lines and words wrap correctly within the code block, preventing horizontal scrolling. */
	overflow-x: auto; /* Enable horizontal scrolling for very long lines */
	font-family: var(
		--vscode-editor-font-family,
		"SF Mono",
		"Cascadia Code",
		"Fira Code",
		monospace
	); /* Use VSCode editor font family */
	font-size: 0.95em; /* Slightly smaller font for code blocks */
	position: relative; /* For potential pseudo-elements like ::before and ::after */
}
.code-file-stream-container pre::before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 3px;
	background: linear-gradient(
		90deg,
		var(--vscode-focusBorder, #007fd4) 0%,
		var(--vscode-textLink-foreground, #3794ff) 50%,
		var(--vscode-focusBorder, #007fd4) 100%
	);
	border-radius: 6px 6px 0 0;
	opacity: 0.8;
}
.code-file-stream-container pre::after {
	content: attr(data-language);
	position: absolute;
	top: 8px;
	right: 12px;
	font-size: 0.75em;
	color: var(--vscode-descriptionForeground, #858585);
	background: var(--vscode-editorWidget-background, rgba(0, 0, 0, 0.1));
	padding: 2px 6px;
	border-radius: 3px;
	opacity: 0.7;
	font-weight: 500;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}
.code-file-stream-container:hover {
	box-shadow:
		0 4px 12px rgba(0, 0, 0, 0.15),
		inset 0 1px 2px rgba(0, 0, 0, 0.05);
	transform: translateY(-1px);
	transition:
		box-shadow 0.2s ease,
		transform 0.2s ease;
}
.code-file-stream-container pre[data-language="typescript"],
.code-file-stream-container pre[data-language="javascript"] {
	border-left: 4px solid var(--vscode-textLink-foreground, #3794ff);
}
.code-file-stream-container pre[data-language="css"],
.code-file-stream-container pre[data-language="scss"] {
	border-left: 4px solid var(--vscode-textPreformat-foreground, #d7ba7d);
}
.code-file-stream-container pre[data-language="html"] {
	border-left: 4px solid var(--vscode-errorForeground, #f44747);
}
.code-file-stream-container pre[data-language="json"] {
	border-left: 4px solid var(--vscode-textPreformat-foreground, #ce9178);
}
.code-file-stream-container pre[data-language="python"] {
	border-left: 4px solid var(--vscode-textLink-foreground, #4ec9b0);
}
.code-file-stream-container pre[data-language="bash"],
.code-file-stream-container code {
	padding: 0; /* Remove padding, as 'pre' element handles it */
	background: none; /* Transparent background, 'pre' has the background color */
	color: var(
		--vscode-editor-foreground
	); /* Use editor foreground color for text */
	border-radius: 0; /* No border radius for the code element itself */
	box-shadow: none; /* No shadow for the code element itself */
	border: none; /* No border for the code element itself */
	white-space: pre-wrap; /* Allow wrapping within code blocks */
	font-size: 0.95em; /* Explicitly set font size for code inside pre */
	word-break: normal; /* Restore default word breaking behavior for code */
	overflow-wrap: break-word; /* Ensure lines and words wrap correctly */
}
.code-file-stream-footer {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 5px 12px; /* Similar to header padding, adjusted for footer */
	border-top: 1px dashed var(--vscode-input-border); /* Separator from code */
	background-color: transparent; /* Changed to transparent background */
	border-radius: 0 0 4px 4px; /* Rounded bottom corners */
	font-size: 0.85em;
	color: var(--vscode-descriptionForeground);
	min-height: 25px; /* Ensure minimum height */
}
.code-file-stream-footer .file-path {
	flex-grow: 1;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	margin-right: 10px; /* Space between path and status */
	font-weight: 500;
}
.code-file-stream-footer .status-indicator {
	display: flex;
	align-items: center;
	gap: 5px;
	flex-shrink: 0; /* Prevent from shrinking */
}
.code-file-stream-footer .loading-dots {
	display: inline-flex;
	font-weight: normal;
	color: var(--vscode-textPreformat-foreground);
	font-style: italic;
	gap: 1px; /* Tighter spacing for dots */
}
.code-file-stream-footer .loading-dots .dot {
	animation: blink 1.4s infinite both; /* Apply blink animation */
	display: inline-block;
}
.code-file-stream-footer .loading-dots .dot:nth-child(1) {
	animation-delay: 0s;
}
.code-file-stream-footer .loading-dots .dot:nth-child(2) {
	animation-delay: 0.2s;
}
.code-file-stream-footer .dot:nth-child(3) {
	animation-delay: 0.4s;
}
.code-file-stream-footer .status-icon {
	font-size: 1.1em;
	vertical-align: middle;
}
.code-file-stream-footer .status-indicator.success .status-icon {
	color: var(--vscode-terminal-ansiGreen); /* Green for success */
}
.code-file-stream-footer .status-indicator.error .status-icon {
	color: var(--vscode-errorForeground); /* Red for error */
}
.code-file-stream-footer .error-details {
	color: var(--vscode-errorForeground);
	font-size: 1em; /* Inherit or similar to parent for consistency */
	margin-left: 5px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	max-width: 200px; /* Limit width of error details */
}
.message-text-content pre.has-copy-button {
	position: relative; /* Essential for positioning the copy button */
	/* Calculate padding-top based on the copy-button-size variable + some buffer */
}
.code-copy-button {
	position: absolute;
	bottom: 5px; /* Position slightly from the top edge of the pre block */
	right: 5px; /* Position slightly from the right edge of the pre block */

	/* Use common variables for size and padding to ensure consistency with other action buttons */
	width: var(--copy-button-size); /* Default width (e.g., 24px) */
	height: var(--copy-button-size); /* Default height (e.g., 24px) */
	padding: var(--copy-button-padding); /* Internal padding (e.g., 4px) */

	/* Match VS Code button styles for background, border, and color */
	background-color: var(--vscode-button-secondaryBackground);
	color: var(--vscode-icon-foreground); /* Icon color */
	border: 1px solid var(--vscode-button-border);
	border-radius: var(--border-radius); /* Use global border radius */
	cursor: pointer;

	/* Flexbox for centering the icon/text */
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 5px; /* Space between icon and text when "Copied!" is shown */

	/* Hide by default and transition smoothly */
	opacity: 0;
	transition:
		opacity 0.2s ease,
		background-color 0.2s ease,
		border-color 0.2s ease,
		transform 0.15s ease-out;
	z-index: 10; /* Ensure it's above code */
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15); /* Subtle shadow for depth */
}
.message-text-content pre.has-copy-button:hover .code-copy-button {
	opacity: 1;
}
.code-copy-button:hover {
	background-color: var(--vscode-button-secondaryHoverBackground);
	border-color: var(--vscode-focusBorder); /* Highlight border on hover */
	color: var(
		--vscode-button-hoverForeground
	); /* Change icon/text color on hover for better contrast */
}
.code-copy-button:active {
	background-color: var(
		--vscode-button-secondaryBackground
	); /* Return to base color for press effect */
	border-color: var(--vscode-focusBorder);
	transform: translateY(1px); /* Slight press effect */
}
.code-copy-button.copied {
	background-color: var(
		--vscode-statusBarItem-remoteBackground
	); /* Greenish background */
	color: var(
		--vscode-statusBarItem-remoteForeground
	); /* White/light text for contrast */
	border-color: var(
		--vscode-statusBarItem-remoteBackground
	); /* Border matches background */
	opacity: 1; /* Keep visible */
	width: auto; /* Allow button to expand to fit "Copied!" text */
	/* More horizontal padding when text is present */
	padding: var(--copy-button-padding) calc(var(--copy-button-padding) * 1.5);
	transform: scale(1.02); /* Subtle "pop" effect */
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); /* More prominent shadow for feedback */
	box-sizing: border-box;
	font-size: 10px;
}
.code-copy-button .fa-icon {
	width: 0.9em;
	height: 0.9em;
	vertical-align: middle;
}

div#commit-message-display pre::before,
.message pre::before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 3px;
	background: linear-gradient(
		90deg,
		var(--vscode-focusBorder, #007fd4) 0%,
		var(--vscode-textLink-foreground, #3794ff) 50%,
		var(--vscode-focusBorder, #007fd4) 100%
	);
	border-radius: 6px 6px 0 0;
	opacity: 0.8;
}
div#commit-message-display pre::after,
.message pre::after {
	content: attr(data-language);
	position: absolute;
	top: 8px;
	right: 12px;
	font-size: 0.75em;
	color: var(--vscode-descriptionForeground, #858585);
	background: var(--vscode-editorWidget-background, rgba(0, 0, 0, 0.1));
	padding: 2px 6px;
	border-radius: 3px;
	opacity: 0.7;
	font-weight: 500;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

div#commit-message-display code,
.message code {
	font-family: var(
		--vscode-editor-font-family,
		"SF Mono",
		"Cascadia Code",
		"Fira Code",
		monospace
	); /* VSCode editor font */
	word-break: normal; /* Prevent breaking in middle of code tokens */
}

div#commit-message-display pre code,
.message pre code {
	padding: 0; /* Remove padding, as 'pre' element handles it */
	background: none; /* Transparent background, 'pre' has the background color */
	color: var(
		--vscode-editor-foreground
	); /* Use editor foreground color for text */
	border-radius: 0; /* No border radius for the code element itself */
	box-shadow: none; /* No shadow for the code element itself */
	border: none; /* No border for the code element itself */
	white-space: pre-wrap; /* Allow wrapping within code blocks */
	font-size: 0.95em; /* Explicitly set font size for code inside pre */
}

div#commit-message-display pre .hljs-keyword,
.message pre .hljs-keyword,
#code-streaming-area pre .hljs-keyword,
div#commit-message-display pre .hljs-built_in,
.message pre .hljs-built_in,
#code-streaming-area pre .hljs-built_in {
	color: var(--vscode-editor-foreground);
	font-weight: 600;
}

div#commit-message-display pre .hljs-string,
.message pre .hljs-string,
#code-streaming-area pre .hljs-string,
div#commit-message-display pre .hljs-literal,
.message pre .hljs-literal,
#code-streaming-area pre .hljs-literal {
	color: var(--vscode-textPreformat-foreground, #d7ba7d);
}

div#commit-message-display pre .hljs-comment,
.message pre .hljs-comment,
#code-streaming-area pre .hljs-comment {
	color: var(--vscode-descriptionForeground, #6a9955);
	font-style: italic;
}

div#commit-message-display pre .hljs-number,
.message pre .hljs-number,
#code-streaming-area pre .hljs-number {
	color: var(--vscode-textPreformat-foreground, #b5cea8);
}

div#commit-message-display pre .hljs-function .hljs-title,
.message pre .hljs-function .hljs-title,
#code-streaming-area pre .hljs-function .hljs-title {
	color: var(--vscode-textLink-foreground, #dcdcaa);
}

div#commit-message-display pre .hljs-title,
.message pre .hljs-title,
#code-streaming-area pre .hljs-title {
	color: var(--vscode-textLink-foreground, #4ec9b0);
}

div#commit-message-display pre .hljs-variable,
.message pre .hljs-variable,
#code-streaming-area pre .hljs-variable,
div#commit-message-display pre .hljs-params,
.message pre .hljs-params,
#code-streaming-area pre .hljs-params {
	color: var(--vscode-editor-foreground);
}

div#commit-message-display pre .hljs-operator,
.message pre .hljs-operator,
#code-streaming-area pre .hljs-operator {
	color: var(--vscode-editor-foreground);
	font-weight: 500;
}

div#commit-message-display pre .hljs-punctuation,
.message pre .hljs-punctuation,
#code-streaming-area pre .hljs-punctuation {
	color: var(--vscode-editor-foreground);
	opacity: 0.8;
}

div#commit-message-display pre .hljs-type,
.message pre .hljs-type,
#code-streaming-area pre .hljs-type {
	color: var(--vscode-textLink-foreground, #4ec9b0);
	font-weight: 500;
}

div#commit-message-display pre .hljs-regexp,
.message pre .hljs-regexp,
#code-streaming-area pre .hljs-regexp {
	color: var(--vscode-textPreformat-foreground, #d16969);
}

div#commit-message-display pre .hljs-template-string,
.message pre .hljs-template-string,
#code-streaming-area pre .hljs-template-string,
div#commit-message-display pre .hljs-subst,
.message pre .hljs-subst,
#code-streaming-area pre .hljs-subst {
	color: var(--vscode-textPreformat-foreground, #ce9178);
}

div#commit-message-display pre .hljs-tag,
.message pre .hljs-tag,
#code-streaming-area pre .hljs-tag {
	color: var(--vscode-textLink-foreground, #569cd6);
}

div#commit-message-display pre .hljs-attr,
.message pre .hljs-attr,
#code-streaming-area pre .hljs-attr {
	color: var(--vscode-textPreformat-foreground, #9cdcfe);
}

div#commit-message-display pre .hljs-property,
.message pre .hljs-property,
#code-streaming-area pre .hljs-property {
	color: var(--vscode-textPreformat-foreground, #9cdcfe);
}

div#commit-message-display pre .hljs-value,
.message pre .hljs-value,
#code-streaming-area pre .hljs-value {
	color: var(--vscode-textPreformat-foreground, #ce9178);
}

div#commit-message-display pre .hljs-keyword.hljs-import,
.message pre .hljs-keyword.hljs-import,
#code-streaming-area pre .hljs-keyword.hljs-import,
div#commit-message-display pre .hljs-keyword.hljs-export,
.message pre .hljs-keyword.hljs-export,
#code-streaming-area pre .hljs-keyword.hljs-export {
	color: var(--vscode-textLink-foreground, #c586c0);
}

div#commit-message-display pre .hljs-built_in.hljs-title,
.message pre .hljs-built_in.hljs-title,
#code-streaming-area pre .hljs-built_in.hljs-title {
	color: var(--vscode-textLink-foreground, #dcdcaa);
}

div#commit-message-display pre .hljs-error,
.message pre .hljs-error,
#code-streaming-area pre .hljs-error {
	color: var(--vscode-errorForeground, #f44747);
}

div#commit-message-display pre .hljs-success,
.message pre .hljs-success,
#code-streaming-area pre .hljs-success {
	color: var(--vscode-textPreformat-foreground, #4ec9b0);
}

div#commit-message-display pre:hover,
.message pre:hover,
#code-streaming-area pre:hover {
	box-shadow:
		0 4px 12px rgba(0, 0, 0, 0.15),
		inset 0 1px 2px rgba(0, 0, 0, 0.05);
	transform: translateY(-1px);
	transition:
		box-shadow 0.2s ease,
		transform 0.2s ease;
}

div#commit-message-display pre + pre,
.message pre + pre {
	margin-top: var(
		--code-consecutive-margin-top,
		1.2em
	); /* More space between consecutive code blocks */
}

div#commit-message-display pre[data-language="typescript"],
.message pre[data-language="typescript"],
#code-streaming-area pre[data-language="typescript"],
div#commit-message-display pre[data-language="javascript"],
.message pre[data-language="javascript"],
#code-streaming-area pre[data-language="javascript"] {
	border-left: 4px solid var(--vscode-textLink-foreground, #3794ff);
}

div#commit-message-display pre[data-language="css"],
.message pre[data-language="css"],
#code-streaming-area pre[data-language="css"],
div#commit-message-display pre[data-language="scss"],
.message pre[data-language="scss"],
#code-streaming-area pre[data-language="scss"] {
	border-left: 4px solid var(--vscode-textPreformat-foreground, #d7ba7d);
}

div#commit-message-display pre[data-language="html"],
.message pre[data-language="html"],
#code-streaming-area pre[data-language="html"] {
	border-left: 4px solid var(--vscode-errorForeground, #f44747);
}

div#commit-message-display pre[data-language="json"],
.message pre[data-language="json"],
#code-streaming-area pre[data-language="json"] {
	border-left: 4px solid var(--vscode-textPreformat-foreground, #ce9178);
}

div#commit-message-display pre[data-language="python"],
.message pre[data-language="python"],
#code-streaming-area pre[data-language="python"] {
	border-left: 4px solid var(--vscode-textLink-foreground, #4ec9b0);
}

div#commit-message-display pre[data-language="bash"],
.message pre[data-language="bash"],
#code-streaming-area pre[data-language="bash"],
div#commit-message-display pre[data-language="shell"],
.message pre[data-language="shell"],
div#commit-message-display :not(pre) > code,
.message :not(pre) > code {
	background: transparent; /* Changed to transparent */
	padding: 0.3em 1em; /* Slightly more padding for better visual appeal */
	border-radius: 4px; /* Slightly more rounded */
	font-size: 0.9em; /* Slightly smaller for inline code */
	border: 1px solid var(--vscode-editorWidget-border, var(--border-color));
	white-space: normal; /* Allow normal text wrapping instead of pre-wrap */
	word-wrap: break-word; /* Allow long words to break and wrap */
	overflow-wrap: break-word; /* Modern property for word wrapping */
	font-family: var(
		--vscode-editor-font-family,
		"SF Mono",
		"Cascadia Code",
		"Fira Code",
		monospace
	); /* Ensure monospace font for inline code */
	color: var(--vscode-editor-foreground); /* Ensure proper text color */
	font-weight: 500; /* Slightly bolder for better readability */
}

#code-streaming-area {
	display: none; /* Hidden by default, shown when streaming */
	flex-direction: column; /* Stacks individual file streams */
	gap: 10px; /* Space between each file's stream container */
	margin-top: 10px;
	margin-bottom: 10px;
	padding: 10px;
	background-color: var(--vscode-editorGroupHeader-tabsBackground);
	border: 1px solid var(--vscode-dropdown-border);
	border-radius: 5px;
	max-height: 150px; /* Limit height and enable scrolling */
	overflow-x: hidden; /* Hide horizontal overflow */
	overflow-y: auto;
	box-shadow: var(--vscode-widget-shadow);
}

/* --- Context Agent Specific Code Blocks --- */
.context-agent-content pre {
	max-height: 0px;
	overflow: hidden;
	padding: 0 !important;
	border: none !important;
	margin: 0 !important;
	opacity: 0;
	transition:
		max-height 0.3s ease,
		padding 0.3s ease,
		opacity 0.2s ease,
		margin 0.2s ease;
	pointer-events: none;
}

.context-agent-content pre.expanded {
	max-height: 150px;
	overflow: auto;
	padding: 12px 16px !important;
	border: 1px solid var(--vscode-editorWidget-border, var(--border-color)) !important;
	margin: 8px 0 !important;
	opacity: 1;
	pointer-events: auto;
}

/* Hide language/indicators in collapsed context agent code blocks */
.context-agent-content pre:not(.expanded)::before,
.context-agent-content pre:not(.expanded)::after,
.context-agent-content pre:not(.expanded) .code-copy-button {
	display: none !important;
}

.context-agent-code-toggle {
	background: var(--vscode-button-secondaryBackground);
	color: var(--vscode-button-secondaryForeground);
	border: 1px solid var(--vscode-button-border);
	border-radius: var(--border-radius);
	padding: 4px 8px;
	font-size: 0.8em;
	cursor: pointer;
	margin: 4px 0;
	display: block;
	width: fit-content;
	transition: background-color 0.2s ease;
}

.context-agent-code-toggle:hover {
	background: var(--vscode-button-secondaryHoverBackground);
}
